{{- if .Values.ingress.enabled }}
1. Ingress
   Access:
   {{- range .Values.ingress.hosts }}
   - http{{ if $.Values.ingress.tls }}s{{ end }}://{{ .host }}{{ (index .paths 0).path | default "/" }}
   {{- end }}
   In k3d (with Traefik), this typically maps to http://localhost:8080/
{{- else }}
{{- if eq .Values.service.type "LoadBalancer" }}
1. Service Type: LoadBalancer
   In k3d, the loadbalancer is mapped in dev/clusterconfig.yaml to:
   - URL: http://localhost:8080/
{{- else if eq .Values.service.type "NodePort" }}
1. Service Type: NodePort
   Find the NodePort:
     kubectl get svc {{ include "gostwriter.fullname" . }} -o jsonpath='{.spec.ports[0].nodePort}'
   Then access via any node IP with that port.
{{- else }}
1. Service Type: ClusterIP
   Port-forward to access locally:
     kubectl port-forward svc/{{ include "gostwriter.fullname" . }} 8080:{{ .Values.service.port }}
   Open:
     http://localhost:8080/
{{- end }}
{{- end }}

2. API Endpoints
   - Health: GET /healthz
   - Create transcription (multipart): POST /v1/transcriptions
     form fields:
       - file: image/png or image/jpeg
       - callback_url (optional)
       - title (optional)
       - metadata (optional JSON)
     headers:
       - Prefer: respond-async (for async processing)
       - X-API-Key: <key> (if configured in config.yaml)

3. Configuration and secrets (file-only)
   - The application always reads configuration from a file, mounted at:
       /app/config/config.yaml
   - Provide this file via one of the following:
     a) Existing Secret (recommended):
        - Create a Secret containing key 'config.yaml':
            kubectl create secret generic gostwriter-config --from-file=config.yaml=path/to/your/config.yaml
        - Set values: existingConfigSecret: "gostwriter-config"
     b) Chart-rendered object (not recommended for real secrets):
        - If configAsSecret=true (default) and no existingConfigSecret is set, the chart renders a Secret named:
            RELEASE-NAME-gostwriter-config
        - If configAsSecret=false, the chart renders a ConfigMap named:
            RELEASE-NAME-gostwriter-config
        - You can supply config via:
          - values.configRaw (string) or
          - structured values (values.server, values.llm, values.target, etc.)
   - Place all sensitive values (e.g., Git tokens) directly in config.yaml under target.auth.token.
     Environment variables are not used for secrets by this chart.

4. Storage
   - Data (SQLite DB, uploads, git clone cache) is mounted at /app/data
   - Persistence is controlled by values.persistence.* (PVC if enabled, otherwise emptyDir)

5. Uninstall
   helm uninstall RELEASE-NAME
